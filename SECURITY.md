# الأمان — منصة البحث

## نقل بيانات الاعتماد (تسجيل الدخول)

### الوضع الحالي

- يتم إرسال **البريد الإلكتروني** و**كلمة المرور** في جسم الطلب (Request Body) بصيغة JSON إلى `/api/auth/login`.
- هذا الأسلوب هو المعتاد في تطبيقات الويب. الخطر ليس من وجود البيانات في الـ Body، بل من نقلها عبر قناة غير مشفرة.

### الحل المعتمد: HTTPS إلزامي في الإنتاج

- عند استخدام **HTTPS**، كامل الطلب (بما فيه الـ Body) يُشفَّر بين المتصفح والخادم. لذلك لا يمكن للمهاجم الذي يعترض الاتصال قراءة كلمة المرور.
- تم دمج منطق الأمان في **Proxy** (`proxy.ts`) في المشروع، ويقوم بما يلي في بيئة الإنتاج:
  - إعادة توجيه الطلبات **HTTP** إلى **HTTPS** (مع دعم `X-Forwarded-Proto` عند وجود وكيل عكسي).
  - تعيين رؤوس أمان مثل:
    - `Strict-Transport-Security` (HSTS)
    - `X-Content-Type-Options: nosniff`
    - `X-Frame-Options: DENY`
    - `X-XSS-Protection`
    - `Referrer-Policy`

### متطلبات النشر

1. **تشغيل التطبيق خلف HTTPS في الإنتاج** (مثلاً: Nginx، Cloudflare، أو مزود الاستضافة مع إنهاء TLS).
2. إذا كان الطلب يصل إلى Next.js عبر وكيل عكسي، تأكد أن الوكيل يمرّر:
   - `X-Forwarded-Proto: https`
   - `X-Forwarded-Host` (إن لزم)
   حتى يعمل إعادة التوجيه إلى HTTPS بشكل صحيح.

### ما تم تجنبه

- **عدم** تسجيل أو طباعة كلمة المرور أو جسم الطلب في السجلات.
- **عدم** إرجاع تفاصيل أخطاء الخادم الداخلية (`error.message`) للعميل في مسار تسجيل الدخول.
- تخزين كلمات المرور في قاعدة البيانات كـ **hash** (bcrypt) وليس كنص واضح.

### ملاحظة حول التشفير من جهة العميل

- تشفير أو تهشير كلمة المرور في المتصفح قبل الإرسال **لا يغني** عن HTTPS.
- بدون HTTPS يظل بالإمكان اعتراض الطلب واستخدام القيمة المرسلة (أو إعادة إرسالها). لذلك **HTTPS إلزامي** لحماية بيانات الاعتماد أثناء النقل.
